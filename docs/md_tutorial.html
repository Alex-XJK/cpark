<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CPARK: Getting Started with cpark: A Step-by-Step Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.jpg"/></td>
  <td id="projectalign">
   <div id="projectname">CPARK<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">A light-weighted, distributed computing framework for C++ that offers a fast and general-purpose large data processing solution.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Getting Started with cpark: A Step-by-Step Tutorial</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md18"></a> </p><blockquote class="doxtable">
<p>&zwj;CPARK develop team - December 7, 2023 </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md19"></a>
1. Check Documentation Website</h1>
<p>Visit the <a href="https://www.alexxu.tech/cpark/">cpark documentation website</a> for comprehensive information, guides, and examples. <br  />
</p>
<p>Especially, on the <a href="https://www.alexxu.tech/cpark/index.html">homepage</a>, there is a general introduction of the whole project and a brief version of how to get started with this project. On the <a href="https://www.alexxu.tech/cpark/md_use__cases.html">Related Pages</a>, there is a screenshot of a real-world shell session to build your first program from scratch. The <a href="https://www.alexxu.tech/cpark/topics.html">Topics</a> page is the main user entry for detailed technical documentation of different types of Creations, Transformations, and Actions, as explained in our design documentation.</p>
<h1><a class="anchor" id="autotoc_md20"></a>
2. Get cpark</h1>
<p>Clone the cpark repository to your local machine:</p>
<div class="fragment"><div class="line">git clone https://github.com/Alex-XJK/cpark.git</div>
</div><!-- fragment --><p>Make sure you are in the main-branch, which has been passing all the automation tests enforced by our branch policy everytime a pull request is trying to merge into main-branch.</p>
<h1><a class="anchor" id="autotoc_md21"></a>
3. Write Your First cpark Code</h1>
<p>With our delicate cpark library on your computer, we can now build some great program using it. <br  />
 First, please create a C++ file, for example, <code>cpark.cpp</code>, and add the following code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="comment">// Include the cpark header files you used</span></div>
<div class="line"><span class="preprocessor">#include &quot;generator_rdd.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;transformed_rdd.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;filter_rdd.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;reduce.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">  <span class="comment">// Set up configuration and execution context</span></div>
<div class="line">  <a class="code hl_class" href="classcpark_1_1_config.html">cpark::Config</a> default_config;</div>
<div class="line">  default_config.<a class="code hl_function" href="classcpark_1_1_config.html#a0463ce1e02a8cea29e685544b8813e7f">setParallelTaskNum</a>(2); <span class="comment">// Set to use 2 cores first</span></div>
<div class="line">  <a class="code hl_class" href="classcpark_1_1_execution_context.html">cpark::ExecutionContext</a> default_context{default_config};</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Define a cpark computation pipeline</span></div>
<div class="line">  <span class="keyword">auto</span> cpark_result =</div>
<div class="line">      <a class="code hl_class" href="classcpark_1_1_generator_rdd.html">cpark::GeneratorRdd</a>(1, 5000000, [&amp;](<span class="keyword">auto</span> i) -&gt; <span class="keyword">auto</span> { <span class="keywordflow">return</span> i; }, &amp;default_context) |</div>
<div class="line">      <a class="code hl_class" href="classcpark_1_1_transform.html">cpark::Transform</a>([](<span class="keyword">auto</span> x) { <span class="keywordflow">return</span> x * x; }) |</div>
<div class="line">      <a class="code hl_class" href="classcpark_1_1_transform.html">cpark::Transform</a>([](<span class="keyword">auto</span> x) {</div>
<div class="line">        <span class="keywordtype">int</span> res = 0;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt;= x; i++) res += x;</div>
<div class="line">        <span class="keywordflow">return</span> res;</div>
<div class="line">      }) |</div>
<div class="line">      <a class="code hl_class" href="classcpark_1_1_filter.html">cpark::Filter</a>([](<span class="keyword">auto</span> x) { <span class="keywordflow">return</span> x % 5 == 0; }) |</div>
<div class="line">      <a class="code hl_class" href="classcpark_1_1_reduce.html">cpark::Reduce</a>([](<span class="keyword">auto</span> x, <span class="keyword">auto</span> y) { <span class="keywordflow">return</span> x + y; });</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Print the result</span></div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;The computation result is &quot;</span> &lt;&lt; cpark_result &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclasscpark_1_1_config_html"><div class="ttname"><a href="classcpark_1_1_config.html">cpark::Config</a></div><div class="ttdef"><b>Definition</b> cpark.h:35</div></div>
<div class="ttc" id="aclasscpark_1_1_config_html_a0463ce1e02a8cea29e685544b8813e7f"><div class="ttname"><a href="classcpark_1_1_config.html#a0463ce1e02a8cea29e685544b8813e7f">cpark::Config::setParallelTaskNum</a></div><div class="ttdeci">Config &amp; setParallelTaskNum(size_t num=0) noexcept</div><div class="ttdef"><b>Definition</b> cpark.h:82</div></div>
<div class="ttc" id="aclasscpark_1_1_execution_context_html"><div class="ttname"><a href="classcpark_1_1_execution_context.html">cpark::ExecutionContext</a></div><div class="ttdef"><b>Definition</b> cpark.h:148</div></div>
<div class="ttc" id="aclasscpark_1_1_filter_html"><div class="ttname"><a href="classcpark_1_1_filter.html">cpark::Filter</a></div><div class="ttdef"><b>Definition</b> filter_rdd.h:161</div></div>
<div class="ttc" id="aclasscpark_1_1_generator_rdd_html"><div class="ttname"><a href="classcpark_1_1_generator_rdd.html">cpark::GeneratorRdd</a></div><div class="ttdef"><b>Definition</b> generator_rdd.h:27</div></div>
<div class="ttc" id="aclasscpark_1_1_reduce_html"><div class="ttname"><a href="classcpark_1_1_reduce.html">cpark::Reduce</a></div><div class="ttdef"><b>Definition</b> reduce.h:24</div></div>
<div class="ttc" id="aclasscpark_1_1_transform_html"><div class="ttname"><a href="classcpark_1_1_transform.html">cpark::Transform</a></div><div class="ttdef"><b>Definition</b> transformed_rdd.h:71</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md22"></a>
4. Configure Your Compiler</h1>
<p>Since our project makes the use of the C++ 20 standard library &lt;ranges&gt; and other new features, you have to ensure that your local compiler supports C++20 and set the correct compilation flag. For example: <code>-std=c++20</code>. <br  />
</p>
<p>You also have to manage your compiler to look for header files in the correct location. <br  />
</p>
<p>So, for this example program, I can compile with <code>g++</code> on my local computer with the following command:</p>
<div class="fragment"><div class="line">g++ cpark.cpp -std=c++20 -Wall -Wpedantic -O2 -I./cpark/include -o cpark_example</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md23"></a>
5. Run Your cpark Code</h1>
<p>Execute the compiled example:</p>
<div class="fragment"><div class="line">./cpark_example</div>
</div><!-- fragment --><p>And you can see the running result as</p>
<div class="fragment"><div class="line">The computation result is -322035642</div>
</div><!-- fragment --><p>While this result number doesn't make sense, because it gets overflow, thus the running result is an undefined behavior, we purposely choose such a large number here for performance comparison below.</p>
<h1><a class="anchor" id="autotoc_md24"></a>
6. Modify Running Configuration</h1>
<p>Noticed that, in your previous code, we were very conservative in choosing 2 cpu cores for the calculation. So now let's run the executable again and see how well it performs: </p><div class="fragment"><div class="line">Home &gt;&gt; time ./cpark_example</div>
<div class="line">The computation result is -322035642</div>
<div class="line">./cpark_example  0.06s user 0.00s system 173% cpu 0.036 total</div>
</div><!-- fragment --><p> the <code>time</code> command reports to us that it used 173% CPU, which is very close to the parameter we set for 2 cores, at which the program took a total of 0.036 seconds. <br  />
</p>
<p>If your computer has more CPU cores, you can also change this parameter to try other parallelism levels. <br  />
</p>
<p>Of course, there is another trick here. If we check the documentation for <a href="https://www.alexxu.tech/cpark/classcpark_1_1_config.html#a0463ce1e02a8cea29e685544b8813e7f">this function</a>, we can see that if we use the default value for this function, we can have cpark library automatically check the number of parallelisms supported by the current hardware setup. </p><div class="fragment"><div class="line"><span class="comment">// Set up configuration and execution context</span></div>
<div class="line"><a class="code hl_class" href="classcpark_1_1_config.html">cpark::Config</a> default_config;</div>
<div class="line">default_config.<a class="code hl_function" href="classcpark_1_1_config.html#a0463ce1e02a8cea29e685544b8813e7f">setParallelTaskNum</a>(); <span class="comment">// Default to physical supported thread number.</span></div>
<div class="line"><a class="code hl_class" href="classcpark_1_1_execution_context.html">cpark::ExecutionContext</a> default_context{default_config};</div>
<div class="line"><span class="comment">// Other code ...</span></div>
</div><!-- fragment --><p> So after we changed the relevant parameters, we can experiment again. </p><div class="fragment"><div class="line">Home &gt;&gt; g++ cpark.cpp -std=c++20 -Wall -Wpedantic -O2 -I./cpark/include -o cpark_example</div>
<div class="line">Home &gt;&gt; time ./cpark_example</div>
<div class="line">The computation result is -322035642</div>
<div class="line">./cpark_example  0.06s user 0.00s system 665% cpu 0.009 total</div>
</div><!-- fragment --><p> It is obvious that it runs significantly faster and the CPU usage is really close to what my computer expected.</p>
<h1><a class="anchor" id="autotoc_md25"></a>
Conclusion: Unleash the Power of Parallel Computing with cpark</h1>
<p>Congratulations! You've successfully embarked on your journey with cpark, a high-performance parallel computing library. As you explore the documentation, you'll discover a wealth of features and capabilities that empower you to tackle complex computations with ease. From parallelized data generation to seamless result reduction, cpark is designed to streamline your code and unlock the full potential of your machine's capabilities.</p>
<p>Whether you're a seasoned developer or new to parallel computing, cpark offers a user-friendly yet powerful framework to elevate your C++ projects. Dive into the documentation, experiment with different pipelines, and leverage the flexibility of cpark to optimize your computations.</p>
<p>Happy coding, and may your parallel computations be as efficient as they are exciting! </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
